<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Xenit RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Xenit Atom Feed"><title data-react-helmet="true">XKF on Github | Xenit</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="http://xenitab.github.io/docs/xks/operator-guide/github"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="XKF on Github | Xenit"><meta data-react-helmet="true" name="description" content="As a XKF user you can use both Azure DevOps and GitHub to store"><meta data-react-helmet="true" property="og:description" content="As a XKF user you can use both Azure DevOps and GitHub to store"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://xenitab.github.io/docs/xks/operator-guide/github"><link data-react-helmet="true" rel="alternate" href="http://xenitab.github.io/docs/xks/operator-guide/github" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://xenitab.github.io/docs/xks/operator-guide/github" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.c2c3d7f4.css">
<link rel="preload" href="/assets/js/runtime~main.0a3f7029.js" as="script">
<link rel="preload" href="/assets/js/main.08e9e087.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Xenit_logo_Svart.png" alt="Xenit logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/Xenit_logo_Vit.png" alt="Xenit logo" class="themedImage_TMUO themedImage--dark_uzRr"></div></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a href="https://github.com/XenitAB" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Xenit Kubernetes Service</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/index">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/architecture-and-design">Architecture and design</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Developer Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Operator Guide</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/operator-guide/index">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/operator-guide/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/operator-guide/agents">Agents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/operator-guide/networking">Networking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/operator-guide/blast-radius">Blast Radius</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/operator-guide/blue-green">Blue Green Clusters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xks/operator-guide/aws-azdo">AWS azure-devops</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/xks/operator-guide/github">XKF on Github</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Kubernetes</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>XKF on Github</h1></header><p>As a XKF user you can use both Azure DevOps and GitHub to store
your Terraform and GitOps repositories.</p><p>In this document we will go through how to use XKF on GitHub focusing
on Infrastructure As Code (IAC) using Terraform.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="terraform">Terraform<a aria-hidden="true" class="hash-link" href="#terraform" title="Direct link to heading">â€‹</a></h2><p>How to run Terraform plan and apply through a GitHub action workflow.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="workflow">Workflow<a aria-hidden="true" class="hash-link" href="#workflow" title="Direct link to heading">â€‹</a></h3><p>Just like in the Azure DevOps case we have created a <a href="https://github.com/XenitAB/azure-devops-templates/terraform-docker-github/README.md" target="_blank" rel="noopener noreferrer">basic pipeline</a> for easy use.</p><p>Below you can find an example pipeline that uses the Github Actions workflow.
Read further down to see how to create the secrets needed to run the pipeline.</p><p>You should store this GitHub action in your Terraform repository under <code>.github/workflows/name.yaml</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI .github/workflows/core.yaml"><pre tabindex="0" class="prism-code language-.github/workflows/core.yaml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">name: terraform_core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">on:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  push:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    branches:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - main</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    paths:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - core/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pull_request:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    paths:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - core/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  workflow_dispatch:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    inputs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      OPA_BLAST_RADIUS:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        description: OPA Blast Radius</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        required: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        default: &quot;50&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">jobs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  terraform:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uses: xenitab/azure-devops-templates/.github/workflows/terraform-docker.yaml@2021.10.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    with:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      DIR: core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      runs-on: &#x27;[&quot;self-hosted&quot;, &quot;linux&quot;]&#x27; # If you do not want to use the default ubuntu-latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ENVIRONMENTS: |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;environments&quot;:[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            {&quot;name&quot;:&quot;dev&quot;},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            {&quot;name&quot;:&quot;qa&quot;},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            {&quot;name&quot;:&quot;prod&quot;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    secrets:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      AZURE_CREDENTIALS_DEV: ${{ secrets.AZURE_CREDENTIALS_DEV }}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      AZURE_CREDENTIALS_QA: ${{ secrets.AZURE_CREDENTIALS_QA }}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      AZURE_CREDENTIALS_PROD: ${{ secrets.AZURE_CREDENTIALS_PROD }}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="self-hosted-runners">Self-hosted runners<a aria-hidden="true" class="hash-link" href="#self-hosted-runners" title="Direct link to heading">â€‹</a></h3><p>It is currently not possible to use self-hosted runners hosted in GitHub organization X while calling on workflows in GitHub organization Y.</p><p>To be able to use self-hosted runners you have to <strong>import (not fork)</strong> the repository to organization X the <a href="https://github.com/XenitAB/azure-devops-templates" target="_blank" rel="noopener noreferrer">workflow repository</a>
and make it public. If you do not do this private repositories located in organization X will not be able to find the workflows.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="azure-service-principal">Azure Service Principal<a aria-hidden="true" class="hash-link" href="#azure-service-principal" title="Direct link to heading">â€‹</a></h3><p>Create a Service Principal(SP) with the access that Terraform requires to perform all the tasks you want.
You can read more about SP creation in our <a href="/docs/xks/operator-guide/getting-started">getting started guide</a></p><p>The workflow is using <a href="https://github.com/marketplace/actions/azure-login#configure-deployment-credentials" target="_blank" rel="noopener noreferrer">Azure Login GitHub Action</a>
to login to Azure. When uploading your SP to GitHub make sure to follow the formatting in the examples.</p><p>This is to prevent unnecessary masking of <code>{ }</code> in your logs which are in dictionary form.</p><p><strong>For example, do</strong>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI .json"><pre tabindex="0" class="prism-code language-.json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&quot;clientId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;clientSecret&quot;: &quot;super-duper-secret-value&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;subscriptionId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;tenantId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>instead of</strong>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI .json"><pre tabindex="0" class="prism-code language-.json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;clientId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;clientSecret&quot;: &quot;super-duper-secret-value&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;subscriptionId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;tenantId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Upload the entire JSON as your GitHub secret.
The workflow uses one secret per environment and we recommend that you follow our naming standard.
The secret name the workflow uses is <strong>AZURE<em>CREDENTIALS</em>\&lt;ENV<!-- -->&gt;</strong>, for example <strong>AZURE_CREDENTIALS_DEV</strong>.</p><p>To upload the secret to GitHub you can use the GitHub UI or you can use the <a href="https://github.com/cli/cli" target="_blank" rel="noopener noreferrer">GitHub CLI</a> to upload secrets to GitHub.</p><p>Assuming that you are storing the SP JSON data in a file you could do:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gh secret -R ORG/xks-terraform </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">set</span><span class="token plain"> AZURE_CREDENTIALS_DEV </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> dev-secrets.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gh secret -R ORG/xks-terraform </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">set</span><span class="token plain"> AZURE_CREDENTIALS_QA </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> qa-secrets.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gh secret -R ORG/xks-terraform </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">set</span><span class="token plain"> AZURE_CREDENTIALS_PROD </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> prod-secrets.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/xenitab/xenitab.github.io/edit/main/docs/xks/operator-guide/github.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/xks/operator-guide/aws-azdo"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->AWS azure-devops</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/xks/operator-guide/kubernetes/aks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AKS<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#terraform" class="table-of-contents__link toc-highlight">Terraform</a><ul><li><a href="#workflow" class="table-of-contents__link toc-highlight">Workflow</a></li><li><a href="#self-hosted-runners" class="table-of-contents__link toc-highlight">Self-hosted runners</a></li><li><a href="#azure-service-principal" class="table-of-contents__link toc-highlight">Azure Service Principal</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.0a3f7029.js"></script>
<script src="/assets/js/main.08e9e087.js"></script>
</body>
</html>